<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f14" />
  <title>Fabrizio Coach</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root{
      --bg:#0b0f14;
      --card:#101826;
      --muted:#7f8ea3;
      --text:#e8eef7;
      --accent:#d4af37;
      --accent2:#7dd3fc;
      --danger:#fb7185;
      --ok:#4ade80;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --r:18px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% -10%, rgba(212,175,55,.18), transparent 60%),
                  radial-gradient(900px 700px at 110% 10%, rgba(125,211,252,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      background: rgba(11,15,20,.82);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .wrap{max-width: 1100px; margin:0 auto; padding: 10px 12px;}
    .toprow{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{width:34px; height:34px; border-radius:12px; background: linear-gradient(135deg, rgba(212,175,55,.9), rgba(212,175,55,.15)); box-shadow: var(--shadow);}
    .title{line-height:1.1;}
    .title b{display:block; font-size:14px; letter-spacing:.3px;}
    .title span{font-size:12px; color:var(--muted);}
    nav.tabs{display:flex; gap:8px; margin-top:10px; overflow:auto; padding-bottom:2px;}
    .tab{flex:0 0 auto; border:1px solid rgba(255,255,255,.10); background: rgba(16,24,38,.55); color:var(--text);
      padding:10px 12px; border-radius: 999px; font-weight:700; font-size:13px; cursor:pointer;}
    .tab.active{border-color: rgba(212,175,55,.55); box-shadow: 0 0 0 2px rgba(212,175,55,.12) inset;}
    main{max-width: 1100px; margin: 0 auto; padding: 14px 12px 90px;}
    .card{background: rgba(16,24,38,.75); border:1px solid rgba(255,255,255,.08); border-radius: var(--r); box-shadow: var(--shadow); padding: 14px;}
    .grid{display:grid; gap:12px;}
    @media(min-width:900px){ .grid.cols2{grid-template-columns: 1.05fr .95fr;} }
    h2{margin:0 0 10px; font-size:16px; letter-spacing:.2px;}
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px;}
    select, input[type="text"], input[type="date"]{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(11,15,20,.55);
      color: var(--text);
      outline:none;
      font-size:14px;
    }
    select:focus, input:focus{border-color: rgba(212,175,55,.55); box-shadow: 0 0 0 3px rgba(212,175,55,.14);}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:end;}
    .row > .field{flex: 1 1 160px; min-width: 150px;}
    .btn{appearance:none; border:0; cursor:pointer;
      background: linear-gradient(135deg, rgba(212,175,55,.95), rgba(212,175,55,.55));
      color:#111; font-weight:900; padding:12px 14px; border-radius: 14px; box-shadow: var(--shadow);}
    .btn.secondary{background: rgba(16,24,38,.75); color:var(--text); border:1px solid rgba(255,255,255,.12);}
    .btn.danger{background: rgba(251,113,133,.22); color: var(--text); border:1px solid rgba(251,113,133,.35);}
    .btn:active{transform: translateY(1px);}
    .muted{color:var(--muted); font-size:12px;}
    .divider{height:1px; background: rgba(255,255,255,.08); margin: 12px 0;}
    /* ROSA */
    .roster{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px;}
    @media(min-width:650px){ .roster{grid-template-columns: repeat(3, minmax(0,1fr));} }
    @media(min-width:1000px){ .roster{grid-template-columns: repeat(4, minmax(0,1fr));} }
    .player{display:flex; align-items:center; gap:10px; padding:10px; border-radius: 16px; background: rgba(11,15,20,.45); border:1px solid rgba(255,255,255,.08); cursor:pointer;}
    .avatar{width:44px; height:44px; border-radius:999px; overflow:hidden; flex:0 0 auto; border:2px solid rgba(212,175,55,.35); background: rgba(255,255,255,.05);}
    .avatar img{width:100%; height:100%; object-fit:cover; display:block;}
    .pname{font-weight:900; font-size:13px; line-height:1.1;}
    .psub{font-size:12px; color:var(--muted);}
    /* Modal fullscreen */
    .modal{position:fixed; inset:0; display:none; z-index:50; background: rgba(0,0,0,.62); backdrop-filter: blur(8px);}
    .modal.show{display:block;}
    .sheet{position:absolute; inset:0; background: rgba(11,15,20,.95); border-top-left-radius: 22px; border-top-right-radius: 22px;
      padding: 14px; overflow:auto;}
    .sheet .close{float:right;}
    .bigAvatar{width:120px; height:120px; border-radius:999px; overflow:hidden; border:3px solid rgba(212,175,55,.45); margin: 10px auto 12px;}
    .bigAvatar img{width:100%; height:100%; object-fit:cover;}
    .center{text-align:center;}
    /* Presenze checklist */
    .checklist{display:grid; gap:8px; margin-top:10px;}
    .check{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px; border-radius: 16px;
      background: rgba(11,15,20,.45); border:1px solid rgba(255,255,255,.08);}
    .check b{font-size:13px;}
    input[type="checkbox"]{width:22px; height:22px; accent-color: var(--accent);}
    .stickyActions{position:fixed; left:0; right:0; bottom:0; padding:10px 12px; background: rgba(11,15,20,.84); backdrop-filter: blur(10px); border-top:1px solid rgba(255,255,255,.08);}
    .stickyActions .wrap{padding:0; max-width:1100px; margin:0 auto; display:flex; gap:10px; align-items:center; justify-content:space-between;}
    /* Tattiche */
    .pitchWrap{position:relative; width:100%; aspect-ratio: 3/2; border-radius: 18px; overflow:hidden;
      border:1px solid rgba(255,255,255,.10); background: rgba(0,0,0,.25);}
    .pitchBg{position:absolute; inset:0; background:url('pitch.png') center/cover no-repeat; filter: saturate(1.05) contrast(1.02);}
    .pitchOverlay{position:absolute; inset:0;}
    .marker{position:absolute; width:48px; height:48px; border-radius:999px; overflow:hidden; border:2px solid rgba(212,175,55,.55);
      background: rgba(255,255,255,.10); box-shadow: 0 10px 20px rgba(0,0,0,.35); touch-action:none;}
    .marker img{width:100%; height:100%; object-fit:cover;}
    .bench{display:flex; gap:8px; overflow:auto; padding:8px 2px;}
    .chip{flex:0 0 auto; display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12); background: rgba(16,24,38,.55); cursor:pointer;}
    .chip .cava{width:28px; height:28px; border-radius:999px; overflow:hidden; border:1px solid rgba(212,175,55,.35);}
    .chip .cava img{width:100%; height:100%; object-fit:cover; display:block;}
    .chip b{font-size:12px;}
    .fullscreen{position:fixed !important; inset:0 !important; border-radius:0 !important; z-index:40;}
    footer{text-align:center; color:var(--muted); font-size:12px; margin-top:14px;}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="toprow">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <b>Fabrizio Coach</b>
          <span>COACH • Vers. 2.1</span>
        </div>
      </div>
      <button class="btn secondary" id="btnResetAll" title="Azzera dati (solo sul tuo dispositivo)">Reset</button>
    </div>

    <nav class="tabs" role="tablist">
      <button class="tab active" data-tab="presenze" role="tab">Presenze</button>
      <button class="tab" data-tab="rosa" role="tab">Rosa</button>
      <button class="tab" data-tab="tattiche" role="tab">Tattiche</button>
    </nav>
  </div>
</header>

<main>
  <section id="tab-presenze" class="grid cols2">
    <div class="card">
      <h2>Presenze</h2>
      <div class="row">
        <div class="field">
          <label for="yearSel">Anno</label>
          <select id="yearSel"></select>
        </div>
        <div class="field">
          <label for="monthSel">Mese</label>
          <select id="monthSel"></select>
        </div>
        <div class="field">
          <label for="dateSel">Giornata (Lun • Mer • Gio)</label>
          <select id="dateSel">
            <option value="">Seleziona giornata</option>
          </select>
        </div>
      </div>

      <div class="divider"></div>

      <div id="attendanceArea" class="muted">Seleziona un mese e una giornata per inserire le presenze.</div>

      <div class="divider"></div>

      <div class="row">
        <button class="btn secondary" id="btnPrintMonth">Stampa PDF mese</button>
        <span class="muted" id="saveHint">Nessuna modifica.</span>
      </div>
    </div>

    <div class="card">
      <h2>Riepilogo mese</h2>
      <div class="muted">Presenze/Assenze e percentuali calcolate sulle giornate (Lun/Mer/Gio) del mese.</div>
      <div class="divider"></div>
      <div id="monthSummary" class="muted">Seleziona un mese per vedere il riepilogo.</div>
    </div>
  </section>

  <section id="tab-rosa" style="display:none">
    <div class="card">
      <h2>Rosa</h2>
      <div class="muted">Tocca un giocatore per aprire la scheda a schermo intero.</div>
      <div class="divider"></div>
      <div id="rosterList" class="roster"></div>
    </div>
  </section>

  <section id="tab-tattiche" style="display:none">
    <div class="grid cols2">
      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:center;">
          <h2 style="margin:0">Tattiche</h2>
          <div style="display:flex; gap:8px;">
            <button class="btn secondary" id="btnToggleFs">Schermo intero</button>
            <button class="btn danger" id="btnClearPitch">Pulisci</button>
          </div>
        </div>
        <div class="divider"></div>
        <div id="pitchWrap" class="pitchWrap" aria-label="Campo da gioco">
          <div class="pitchBg"></div>
          <div class="pitchOverlay" id="pitchOverlay"></div>
        </div>
        <div class="muted" style="margin-top:10px;">Tocca un giocatore dalla panchina per inserirlo sul campo, poi trascinalo.</div>
      </div>

      <div class="card">
        <h2>Panchina</h2>
        <div class="muted">Tocca per aggiungere al campo.</div>
        <div class="divider"></div>
        <div id="bench" class="bench"></div>
      </div>
    </div>
  </section>

  <footer>Salvataggio locale sul dispositivo • v29 / 2.1</footer>
</main>

<div class="modal" id="playerModal" aria-hidden="true">
  <div class="sheet">
    <button class="btn secondary close" id="closeModal">Chiudi</button>
    <div class="center">
      <div class="bigAvatar"><img id="modalImg" alt=""></div>
      <div class="pname" id="modalName" style="font-size:18px;"></div>
      <div class="psub" id="modalSub"></div>
      <div class="divider"></div>
      <div class="muted" id="modalInfo"></div>
    </div>
  </div>
</div>

<div class="stickyActions" id="stickyActions" style="display:none">
  <div class="wrap">
    <span class="muted" id="stickyLabel">Modifiche non salvate</span>
    <button class="btn" id="btnSaveDay">SALVA</button>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
